<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HashConnect Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
        }
        #output {
            background: #f0f0f0;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>HashConnect Library Test</h1>
    
    <button onclick="testCDN1()">Test CDN 1: UMD Build</button>
    <button onclick="testCDN2()">Test CDN 2: ES Module</button>
    <button onclick="testCDN3()">Test CDN 3: Bundle</button>
    <button onclick="testManual()">Test Manual Load</button>
    
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(msg, type = '') {
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            output.appendChild(entry);
            console.log(msg);
        }
        
        function clearOutput() {
            output.innerHTML = '';
        }
        
        async function testCDN1() {
            clearOutput();
            log('Testing UMD build from unpkg...');
            
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/hashconnect@3/dist/umd/index.js';
            
            script.onload = () => {
                log('Script loaded!', 'success');
                checkHashConnect();
            };
            
            script.onerror = (e) => {
                log('Failed to load script: ' + e, 'error');
            };
            
            document.head.appendChild(script);
        }
        
        async function testCDN2() {
            clearOutput();
            log('Testing ES module from unpkg...');
            
            try {
                const module = await import('https://unpkg.com/hashconnect@3/dist/esm/index.js');
                log('Module loaded!', 'success');
                log('Module contents: ' + Object.keys(module).join(', '));
                
                if (module.HashConnect) {
                    window.HashConnect = module.HashConnect;
                    checkHashConnect();
                }
            } catch (error) {
                log('Failed to load module: ' + error.message, 'error');
            }
        }
        
        async function testCDN3() {
            clearOutput();
            log('Testing bundle from jsdelivr...');
            
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/hashconnect@latest/dist/hashconnect.min.js';
            
            script.onload = () => {
                log('Script loaded!', 'success');
                checkHashConnect();
            };
            
            script.onerror = (e) => {
                log('Failed to load script: ' + e, 'error');
            };
            
            document.head.appendChild(script);
        }
        
        async function testManual() {
            clearOutput();
            log('Testing manual initialization...');
            
            // Try to use HashConnect if it's available
            if (typeof HashConnect !== 'undefined') {
                log('HashConnect is available!', 'success');
                
                try {
                    const appMetadata = {
                        name: "Test App",
                        description: "Testing HashConnect",
                        url: window.location.origin,
                        icons: [window.location.origin + "/icon.png"]
                    };
                    
                    log('Creating HashConnect instance...');
                    const hc = new HashConnect(
                        "testnet",
                        "41a1d0cc4e04c3d6300a73be45d92b3c",
                        appMetadata,
                        true
                    );
                    
                    log('HashConnect instance created!', 'success');
                    
                    log('Initializing...');
                    await hc.init();
                    
                    log('HashConnect initialized successfully!', 'success');
                    log('Opening pairing modal...');
                    
                    hc.openPairingModal();
                    
                } catch (error) {
                    log('Error: ' + error.message, 'error');
                    log('Stack: ' + error.stack, 'error');
                }
            } else {
                log('HashConnect not found in window', 'error');
                log('Available globals: ' + Object.keys(window).filter(k => 
                    k.toLowerCase().includes('hash') || 
                    k.toLowerCase().includes('connect')
                ).join(', '));
            }
        }
        
        function checkHashConnect() {
            log('Checking for HashConnect...');
            
            if (typeof HashConnect !== 'undefined') {
                log('✓ HashConnect found!', 'success');
                log('HashConnect type: ' + typeof HashConnect);
                log('HashConnect constructor: ' + HashConnect.toString().substring(0, 100) + '...');
            } else {
                log('✗ HashConnect not found', 'error');
            }
            
            // Check for other possible locations
            const locations = [
                'window.HashConnect',
                'window.hashconnect',
                'window.Hashconnect',
                'window.hc'
            ];
            
            locations.forEach(loc => {
                const val = eval(loc);
                if (val) {
                    log(`Found at ${loc}: ${typeof val}`, 'success');
                }
            });
        }
        
        // Check on load
        window.addEventListener('load', () => {
            log('Page loaded. Initial check:');
            checkHashConnect();
        });
    </script>
</body>
</html>